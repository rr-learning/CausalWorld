

<!DOCTYPE html>
<html class="writer-html5" lang="python" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Getting Started &mdash; causal_rl_bench 1.0.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Task distributions" href="task_setups.html" />
    <link rel="prev" title="Installation" href="install.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> causal_rl_bench
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#basics-setting-up-an-environment-with-different-tasks">Basics: Setting up an environment with different tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#changing-the-environment-instance-performing-interventions">Changing the environment instance: Performing interventions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#training-agents-using-stable-baselines">Training agents using stable-baselines</a></li>
<li class="toctree-l2"><a class="reference internal" href="#viewing-and-recording-policies-or-logged-data">Viewing and recording policies or logged data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#defining-a-training-curriculum-of-task-variations">Defining a training curriculum of task variations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#changing-the-action-space-of-the-robot">Changing the action space of the robot</a></li>
<li class="toctree-l2"><a class="reference internal" href="#other-utilities-model-predictive-control-logging-data-loading-wrapped-environments">Other Utilities: Model Predictive Control, Logging data, loading wrapped environments</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="task_setups.html">Task distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="evaluating_policy.html">Evaluation Protocols</a></li>
</ul>
<p class="caption"><span class="caption-text">Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules/causal_rl_bench.html">CausalRLBench</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">causal_rl_bench</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Getting Started</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/guide/getting_started.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="getting-started">
<span id="id1"></span><h1>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h1>
<p>Welcome to CausalRlBench!</p>
<p>CausalRlBench is a package that is designed to develop, test and benchmark your RL agents within robotics manipulation
environments - from simple to extremely challenging. Each environments comprises a simulation
version of the &quot;TriFinger robot&quot; that has three fingers - each with 3 joints - to learn dexterous object
manipulation skills with rigid bodies available in a stage. We provide benchmark tasks like reaching, pushing, picking
or pick and place single objects but also much more involved tasks like stacking towers, restoring a certain scene of
objects or building structures that require imagination.</p>
<p>All environments are compatible with the OpenAI gym standard equipped with additional functionality, which means you
can start out of the box with most of your favorite algorithms.</p>
<p>Setting up an environment can be as simple as two lines of codes</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">causal_rl_bench.envs.causalworld</span> <span class="kn">import</span> <span class="n">CausalWorld</span>
<span class="kn">from</span> <span class="nn">causal_rl_bench.task_generators.task</span> <span class="kn">import</span> <span class="n">task_generator</span>

<span class="n">task</span> <span class="o">=</span> <span class="n">task_generator</span><span class="p">(</span><span class="n">task_generator_id</span><span class="o">=</span><span class="s1">&#39;stacked_blocks&#39;</span><span class="p">)</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">CausalWorld</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">)</span>
<span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2000</span><span class="p">):</span>
    <span class="n">obs</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">sample</span><span class="p">())</span>
<span class="n">env</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>By default you are getting an task that has a feature observation space, takes 9 joint positions for the action
spaces and allows you to solve the task within the number of objects in the arena times 10 seconds. All of this is
easy customizable as you will learn in one of the many tutorials provided.</p>
<div class="section" id="basics-setting-up-an-environment-with-different-tasks">
<h2>Basics: Setting up an environment with different tasks<a class="headerlink" href="#basics-setting-up-an-environment-with-different-tasks" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">causal_rl_bench.envs.causalworld</span> <span class="kn">import</span> <span class="n">CausalWorld</span>
<span class="kn">from</span> <span class="nn">causal_rl_bench.task_generators.task</span> <span class="kn">import</span> <span class="n">task_generator</span>


<span class="k">def</span> <span class="nf">example</span><span class="p">():</span>
    <span class="n">task</span> <span class="o">=</span> <span class="n">task_generator</span><span class="p">(</span><span class="n">task_generator_id</span><span class="o">=</span><span class="s1">&#39;picking&#39;</span><span class="p">)</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">CausalWorld</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span> <span class="n">enable_visualization</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
        <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
            <span class="n">obs</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">sample</span><span class="p">())</span>
    <span class="n">env</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">example</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">causal_rl_bench.envs.causalworld</span> <span class="kn">import</span> <span class="n">CausalWorld</span>
<span class="kn">from</span> <span class="nn">causal_rl_bench.task_generators.task</span> <span class="kn">import</span> <span class="n">task_generator</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>


<span class="k">def</span> <span class="nf">example</span><span class="p">():</span>
    <span class="n">task</span> <span class="o">=</span> <span class="n">task_generator</span><span class="p">(</span><span class="n">task_generator_id</span><span class="o">=</span><span class="s1">&#39;stacked_blocks&#39;</span><span class="p">)</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">CausalWorld</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span> <span class="n">skip_frame</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">enable_visualization</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                      <span class="n">action_mode</span><span class="o">=</span><span class="s2">&quot;joint_positions&quot;</span><span class="p">,</span> <span class="n">observation_mode</span><span class="o">=</span><span class="s2">&quot;cameras&quot;</span><span class="p">)</span>
    <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="n">obs</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">sample</span><span class="p">())</span>
    <span class="c1"># Show last camera observations</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">obs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">env</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">example</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">causal_rl_bench.envs.causalworld</span> <span class="kn">import</span> <span class="n">CausalWorld</span>
<span class="kn">from</span> <span class="nn">causal_rl_bench.task_generators.task</span> <span class="kn">import</span> <span class="n">task_generator</span>


<span class="k">def</span> <span class="nf">control_policy</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">obs</span><span class="p">):</span>
    <span class="k">return</span> \
        <span class="n">env</span><span class="o">.</span><span class="n">get_robot</span><span class="p">()</span><span class="o">.</span><span class="n">get_joint_positions_from_tip_positions</span><span class="p">(</span>
            <span class="n">obs</span><span class="p">[</span><span class="o">-</span><span class="mi">9</span><span class="p">:],</span> <span class="n">obs</span><span class="p">[:</span><span class="mi">9</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">end_effector_pos</span><span class="p">():</span>
    <span class="n">task</span> <span class="o">=</span> <span class="n">task_generator</span><span class="p">(</span><span class="n">task_generator_id</span><span class="o">=</span><span class="s1">&#39;reaching&#39;</span><span class="p">)</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">CausalWorld</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span> <span class="n">enable_visualization</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">action_mode</span><span class="o">=</span><span class="s2">&quot;joint_positions&quot;</span><span class="p">,</span> <span class="n">normalize_actions</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                      <span class="n">normalize_observations</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">obs</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
        <span class="n">goal_dict</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">sample_new_goal</span><span class="p">()</span>
        <span class="n">env</span><span class="o">.</span><span class="n">do_intervention</span><span class="p">(</span><span class="n">goal_dict</span><span class="p">)</span>
        <span class="n">obs</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">obs</span><span class="p">[</span><span class="o">-</span><span class="mi">9</span><span class="p">:])</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">250</span><span class="p">):</span>
            <span class="n">obs</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">control_policy</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">obs</span><span class="p">))</span>
    <span class="n">env</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">end_effector_pos</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="changing-the-environment-instance-performing-interventions">
<h2>Changing the environment instance: Performing interventions<a class="headerlink" href="#changing-the-environment-instance-performing-interventions" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">causal_rl_bench.envs.causalworld</span> <span class="kn">import</span> <span class="n">CausalWorld</span>
<span class="kn">from</span> <span class="nn">causal_rl_bench.task_generators.task</span> <span class="kn">import</span> <span class="n">task_generator</span>


<span class="k">def</span> <span class="nf">example</span><span class="p">():</span>
    <span class="n">task</span> <span class="o">=</span> <span class="n">task_generator</span><span class="p">(</span><span class="n">task_generator_id</span><span class="o">=</span><span class="s1">&#39;picking&#39;</span><span class="p">)</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">CausalWorld</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span> <span class="n">enable_visualization</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># env.reset()</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
            <span class="n">obs</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">sample</span><span class="p">())</span>
            <span class="n">random_intervention_dict</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">do_single_random_intervention</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;resetting&quot;</span><span class="p">)</span>
        <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">200</span><span class="p">):</span>
            <span class="n">obs</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">sample</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The random intervention performed is &quot;</span><span class="p">,</span> <span class="n">random_intervention_dict</span><span class="p">)</span>
    <span class="n">env</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">example</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">causal_rl_bench.envs.causalworld</span> <span class="kn">import</span> <span class="n">CausalWorld</span>
<span class="kn">from</span> <span class="nn">causal_rl_bench.task_generators.task</span> <span class="kn">import</span> <span class="n">task_generator</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>


<span class="k">def</span> <span class="nf">without_intervention_split</span><span class="p">():</span>
    <span class="n">task</span> <span class="o">=</span> <span class="n">task_generator</span><span class="p">(</span><span class="n">task_generator_id</span><span class="o">=</span><span class="s1">&#39;pushing&#39;</span><span class="p">)</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">CausalWorld</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span> <span class="n">enable_visualization</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">200</span><span class="p">):</span>
            <span class="n">obs</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">sample</span><span class="p">())</span>
        <span class="n">success_signal</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">do_intervention</span><span class="p">({</span><span class="s1">&#39;stage_color&#39;</span><span class="p">:</span>
                                                  <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span>
                                                                    <span class="mi">1</span><span class="p">,</span>
                                                                    <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="p">])})</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Intervention success signal&quot;</span><span class="p">,</span> <span class="n">success_signal</span><span class="p">)</span>
    <span class="n">env</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">with_intervention_split_1</span><span class="p">():</span>
    <span class="n">task</span> <span class="o">=</span> <span class="n">task_generator</span><span class="p">(</span><span class="n">task_generator_id</span><span class="o">=</span><span class="s1">&#39;pushing&#39;</span><span class="p">,</span> <span class="n">intervention_split</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">training</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">CausalWorld</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span> <span class="n">enable_visualization</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">200</span><span class="p">):</span>
            <span class="n">obs</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">sample</span><span class="p">())</span>
        <span class="n">success_signal</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">do_intervention</span><span class="p">({</span><span class="s1">&#39;stage_color&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="p">])})</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Intervention success signal&quot;</span><span class="p">,</span> <span class="n">success_signal</span><span class="p">)</span>
    <span class="n">env</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">with_intervention_split_2</span><span class="p">():</span>
    <span class="n">task</span> <span class="o">=</span> <span class="n">task_generator</span><span class="p">(</span><span class="n">task_generator_id</span><span class="o">=</span><span class="s1">&#39;pushing&#39;</span><span class="p">,</span> <span class="n">intervention_split</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">training</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">CausalWorld</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span> <span class="n">enable_visualization</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">interventions_space</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">get_training_intervention_spaces</span><span class="p">()</span>
    <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">200</span><span class="p">):</span>
            <span class="n">obs</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">sample</span><span class="p">())</span>
        <span class="n">success_signal</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">do_intervention</span><span class="p">({</span><span class="s1">&#39;stage_color&#39;</span><span class="p">:</span>
                                                  <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">interventions_space</span><span class="p">[</span><span class="s1">&#39;stage_color&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                                                    <span class="n">interventions_space</span><span class="p">[</span><span class="s1">&#39;stage_color&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])})</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Intervention success signal&quot;</span><span class="p">,</span> <span class="n">success_signal</span><span class="p">)</span>
    <span class="n">env</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">without_intervention_split</span><span class="p">()</span>
    <span class="c1"># with_intervention_split_1()</span>
    <span class="c1"># with_intervention_split_2()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">causal_rl_bench.envs.causalworld</span> <span class="kn">import</span> <span class="n">CausalWorld</span>
<span class="kn">from</span> <span class="nn">causal_rl_bench.task_generators.task</span> <span class="kn">import</span> <span class="n">task_generator</span>


<span class="k">def</span> <span class="nf">goal_interventions</span><span class="p">():</span>
    <span class="n">task</span> <span class="o">=</span> <span class="n">task_generator</span><span class="p">(</span><span class="n">task_generator_id</span><span class="o">=</span><span class="s1">&#39;picking&#39;</span><span class="p">)</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">CausalWorld</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span> <span class="n">enable_visualization</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">200</span><span class="p">):</span>
            <span class="n">obs</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">sample</span><span class="p">())</span>
        <span class="n">goal_intervention_dict</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">sample_new_goal</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;new goal chosen: &quot;</span><span class="p">,</span> <span class="n">goal_intervention_dict</span><span class="p">)</span>
        <span class="n">success_signal</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">do_intervention</span><span class="p">(</span><span class="n">goal_intervention_dict</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Goal Intervention success signal&quot;</span><span class="p">,</span> <span class="n">success_signal</span><span class="p">)</span>
    <span class="n">env</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">goal_interventions</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">causal_rl_bench.envs.causalworld</span> <span class="kn">import</span> <span class="n">CausalWorld</span>
<span class="kn">from</span> <span class="nn">causal_rl_bench.task_generators.task</span> <span class="kn">import</span> <span class="n">task_generator</span>


<span class="k">def</span> <span class="nf">privileged_information</span><span class="p">():</span>
    <span class="n">task</span> <span class="o">=</span> <span class="n">task_generator</span><span class="p">(</span><span class="n">task_generator_id</span><span class="o">=</span><span class="s1">&#39;pushing&#39;</span><span class="p">)</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">CausalWorld</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span> <span class="n">enable_visualization</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">goal_intervention_dict</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">sample_new_goal</span><span class="p">()</span>
        <span class="n">success_signal</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">do_intervention</span><span class="p">(</span><span class="n">goal_intervention_dict</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Goal Intervention success signal&quot;</span><span class="p">,</span> <span class="n">success_signal</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
            <span class="n">obs</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">low</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;now we solve it with privileged info&quot;</span><span class="p">)</span>
        <span class="n">success_signal</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">do_intervention</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;possible_solution_intervention&#39;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Partial Solution Setting Intervention Succes Signal&quot;</span><span class="p">,</span> <span class="n">success_signal</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">500</span><span class="p">):</span>
            <span class="n">obs</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">low</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">reward</span><span class="p">)</span>
    <span class="n">env</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">privileged_information</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="training-agents-using-stable-baselines">
<h2>Training agents using stable-baselines<a class="headerlink" href="#training-agents-using-stable-baselines" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">causal_rl_bench.task_generators.task</span> <span class="kn">import</span> <span class="n">task_generator</span>
<span class="kn">from</span> <span class="nn">causal_rl_bench.envs.causalworld</span> <span class="kn">import</span> <span class="n">CausalWorld</span>
<span class="kn">from</span> <span class="nn">stable_baselines</span> <span class="kn">import</span> <span class="n">PPO2</span>
<span class="kn">from</span> <span class="nn">stable_baselines.common.policies</span> <span class="kn">import</span> <span class="n">MlpPolicy</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="n">tf</span><span class="o">.</span><span class="n">compat</span><span class="o">.</span><span class="n">v1</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">set_verbosity</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">compat</span><span class="o">.</span><span class="n">v1</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">stable_baselines.common</span> <span class="kn">import</span> <span class="n">set_global_seeds</span>
<span class="kn">from</span> <span class="nn">stable_baselines.common.vec_env</span> <span class="kn">import</span> <span class="n">SubprocVecEnv</span>
<span class="kn">import</span> <span class="nn">argparse</span>


<span class="k">def</span> <span class="nf">train_policy</span><span class="p">(</span><span class="n">num_of_envs</span><span class="p">,</span> <span class="n">log_relative_path</span><span class="p">,</span> <span class="n">maximum_episode_length</span><span class="p">,</span>
                 <span class="n">skip_frame</span><span class="p">,</span> <span class="n">seed_num</span><span class="p">,</span> <span class="n">ppo_config</span><span class="p">,</span> <span class="n">total_time_steps</span><span class="p">,</span>
                 <span class="n">validate_every_timesteps</span><span class="p">,</span> <span class="n">task_name</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_make_env</span><span class="p">(</span><span class="n">rank</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">_init</span><span class="p">():</span>
            <span class="n">task</span> <span class="o">=</span> <span class="n">task_generator</span><span class="p">(</span><span class="n">task_generator_id</span><span class="o">=</span><span class="n">task_name</span><span class="p">)</span>
            <span class="n">env</span> <span class="o">=</span> <span class="n">CausalWorld</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span> <span class="n">skip_frame</span><span class="o">=</span><span class="n">skip_frame</span><span class="p">,</span>
                              <span class="n">enable_visualization</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                              <span class="n">seed</span><span class="o">=</span><span class="n">seed_num</span> <span class="o">+</span> <span class="n">rank</span><span class="p">,</span> <span class="n">max_episode_length</span><span class="o">=</span>
                        <span class="n">maximum_episode_length</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">env</span>

        <span class="n">set_global_seeds</span><span class="p">(</span><span class="n">seed_num</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_init</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">log_relative_path</span><span class="p">)</span>
    <span class="n">policy_kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">act_fun</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">tanh</span><span class="p">,</span> <span class="n">net_arch</span><span class="o">=</span><span class="p">[</span><span class="mi">256</span><span class="p">,</span> <span class="mi">128</span><span class="p">])</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">SubprocVecEnv</span><span class="p">([</span><span class="n">_make_env</span><span class="p">(</span><span class="n">rank</span><span class="o">=</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_of_envs</span><span class="p">)])</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">PPO2</span><span class="p">(</span><span class="n">MlpPolicy</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">_init_setup_model</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">policy_kwargs</span><span class="o">=</span><span class="n">policy_kwargs</span><span class="p">,</span>
                 <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">ppo_config</span><span class="p">)</span>
    <span class="n">save_config_file</span><span class="p">(</span><span class="n">ppo_config</span><span class="p">,</span> <span class="n">_make_env</span><span class="p">(</span><span class="mi">0</span><span class="p">)(),</span>
                     <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">log_relative_path</span><span class="p">,</span> <span class="s1">&#39;config.json&#39;</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">total_time_steps</span> <span class="o">/</span> <span class="n">validate_every_timesteps</span><span class="p">)):</span>
        <span class="n">model</span><span class="o">.</span><span class="n">learn</span><span class="p">(</span><span class="n">total_timesteps</span><span class="o">=</span><span class="n">validate_every_timesteps</span><span class="p">,</span>
                    <span class="n">tb_log_name</span><span class="o">=</span><span class="s2">&quot;ppo2&quot;</span><span class="p">,</span>
                    <span class="n">reset_num_timesteps</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">log_relative_path</span><span class="p">,</span> <span class="s1">&#39;saved_model&#39;</span><span class="p">))</span>
    <span class="k">return</span>


<span class="k">def</span> <span class="nf">save_config_file</span><span class="p">(</span><span class="n">ppo_config</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
    <span class="n">task_config</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">_task</span><span class="o">.</span><span class="n">get_task_params</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">task_param</span> <span class="ow">in</span> <span class="n">task_config</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">task_config</span><span class="p">[</span><span class="n">task_param</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">task_config</span><span class="p">[</span><span class="n">task_param</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">task_config</span><span class="p">[</span><span class="n">task_param</span><span class="p">])</span>
    <span class="n">env_config</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get_world_params</span><span class="p">()</span>
    <span class="n">env</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">configs_to_save</span> <span class="o">=</span> <span class="p">[</span><span class="n">task_config</span><span class="p">,</span> <span class="n">env_config</span><span class="p">,</span> <span class="n">ppo_config</span><span class="p">]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">configs_to_save</span><span class="p">,</span> <span class="n">fout</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">ap</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="c1">#TODO: pass reward weights here!!</span>
    <span class="n">ap</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--seed_num&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;seed number&quot;</span><span class="p">)</span>
    <span class="n">ap</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--skip_frame&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;skip frame&quot;</span><span class="p">)</span>
    <span class="n">ap</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--max_episode_length&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">2500</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;maximum episode length&quot;</span><span class="p">)</span>
    <span class="n">ap</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--total_time_steps_per_update&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">default</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;total time steps per update&quot;</span><span class="p">)</span>
    <span class="n">ap</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--num_of_envs&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">default</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;number of parallel environments&quot;</span><span class="p">)</span>
    <span class="n">ap</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--task_name&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">default</span><span class="o">=</span><span class="s2">&quot;reaching&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;the task nam for training&quot;</span><span class="p">)</span>
    <span class="n">ap</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--fixed_position&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;define the reset intervention wrapper&quot;</span><span class="p">)</span>
    <span class="n">ap</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--log_relative_path&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;log folder&quot;</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="n">ap</span><span class="o">.</span><span class="n">parse_args</span><span class="p">())</span>
    <span class="n">total_time_steps_per_update</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;total_time_steps_per_update&#39;</span><span class="p">])</span>
    <span class="n">num_of_envs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;num_of_envs&#39;</span><span class="p">])</span>
    <span class="n">log_relative_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;log_relative_path&#39;</span><span class="p">])</span>
    <span class="n">maximum_episode_length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;max_episode_length&#39;</span><span class="p">])</span>
    <span class="n">skip_frame</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;skip_frame&#39;</span><span class="p">])</span>
    <span class="n">seed_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;seed_num&#39;</span><span class="p">])</span>
    <span class="n">task_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;task_name&#39;</span><span class="p">])</span>
    <span class="n">fixed_position</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;fixed_position&#39;</span><span class="p">])</span>
    <span class="k">assert</span> <span class="p">(((</span><span class="nb">float</span><span class="p">(</span><span class="n">total_time_steps_per_update</span><span class="p">)</span> <span class="o">/</span>
             <span class="n">num_of_envs</span><span class="p">)</span><span class="o">/</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">is_integer</span><span class="p">())</span>
    <span class="n">ppo_config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;gamma&quot;</span><span class="p">:</span> <span class="mf">0.9995</span><span class="p">,</span>
                  <span class="s2">&quot;n_steps&quot;</span><span class="p">:</span> <span class="mi">5000</span><span class="p">,</span>
                  <span class="s2">&quot;ent_coef&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                  <span class="s2">&quot;learning_rate&quot;</span><span class="p">:</span> <span class="mf">0.00025</span><span class="p">,</span>
                  <span class="s2">&quot;vf_coef&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
                  <span class="s2">&quot;max_grad_norm&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
                  <span class="s2">&quot;nminibatches&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
                  <span class="s2">&quot;noptepochs&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
                  <span class="s2">&quot;tensorboard_log&quot;</span><span class="p">:</span> <span class="n">log_relative_path</span><span class="p">}</span>
    <span class="n">train_policy</span><span class="p">(</span><span class="n">num_of_envs</span><span class="o">=</span><span class="n">num_of_envs</span><span class="p">,</span>
                 <span class="n">log_relative_path</span><span class="o">=</span><span class="n">log_relative_path</span><span class="p">,</span>
                 <span class="n">maximum_episode_length</span><span class="o">=</span><span class="n">maximum_episode_length</span><span class="p">,</span>
                 <span class="n">skip_frame</span><span class="o">=</span><span class="n">skip_frame</span><span class="p">,</span>
                 <span class="n">seed_num</span><span class="o">=</span><span class="n">seed_num</span><span class="p">,</span>
                 <span class="n">ppo_config</span><span class="o">=</span><span class="n">ppo_config</span><span class="p">,</span>
                 <span class="n">total_time_steps</span><span class="o">=</span><span class="mi">60000000</span><span class="p">,</span>
                 <span class="n">validate_every_timesteps</span><span class="o">=</span><span class="mi">1000000</span><span class="p">,</span>
                 <span class="n">task_name</span><span class="o">=</span><span class="n">task_name</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">causal_rl_bench.task_generators.task</span> <span class="kn">import</span> <span class="n">task_generator</span>
<span class="kn">from</span> <span class="nn">causal_rl_bench.envs.causalworld</span> <span class="kn">import</span> <span class="n">CausalWorld</span>
<span class="kn">from</span> <span class="nn">stable_baselines</span> <span class="kn">import</span> <span class="n">HER</span><span class="p">,</span> <span class="n">SAC</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="n">tf</span><span class="o">.</span><span class="n">compat</span><span class="o">.</span><span class="n">v1</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">set_verbosity</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">compat</span><span class="o">.</span><span class="n">v1</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">stable_baselines.common</span> <span class="kn">import</span> <span class="n">set_global_seeds</span>
<span class="kn">from</span> <span class="nn">stable_baselines.common.vec_env</span> <span class="kn">import</span> <span class="n">SubprocVecEnv</span>
<span class="kn">from</span> <span class="nn">causal_rl_bench.wrappers.env_wrappers</span> <span class="kn">import</span> <span class="n">HERGoalEnvWrapper</span>
<span class="kn">import</span> <span class="nn">argparse</span>


<span class="k">def</span> <span class="nf">train_policy</span><span class="p">(</span><span class="n">num_of_envs</span><span class="p">,</span> <span class="n">log_relative_path</span><span class="p">,</span> <span class="n">maximum_episode_length</span><span class="p">,</span>
                 <span class="n">skip_frame</span><span class="p">,</span> <span class="n">seed_num</span><span class="p">,</span> <span class="n">sac_config</span><span class="p">,</span> <span class="n">total_time_steps</span><span class="p">,</span>
                 <span class="n">validate_every_timesteps</span><span class="p">,</span> <span class="n">task_name</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_make_env</span><span class="p">(</span><span class="n">rank</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">_init</span><span class="p">():</span>
            <span class="n">task</span> <span class="o">=</span> <span class="n">task_generator</span><span class="p">(</span><span class="n">task_generator_id</span><span class="o">=</span><span class="n">task_name</span><span class="p">)</span>
            <span class="n">env</span> <span class="o">=</span> <span class="n">CausalWorld</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span> <span class="n">skip_frame</span><span class="o">=</span><span class="n">skip_frame</span><span class="p">,</span>
                              <span class="n">enable_visualization</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                              <span class="n">seed</span><span class="o">=</span><span class="n">seed_num</span> <span class="o">+</span> <span class="n">rank</span><span class="p">,</span> <span class="n">max_episode_length</span><span class="o">=</span>
                        <span class="n">maximum_episode_length</span><span class="p">)</span>
            <span class="n">env</span> <span class="o">=</span> <span class="n">HERGoalEnvWrapper</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">env</span>

        <span class="n">set_global_seeds</span><span class="p">(</span><span class="n">seed_num</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_init</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">log_relative_path</span><span class="p">)</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">SubprocVecEnv</span><span class="p">([</span><span class="n">_make_env</span><span class="p">(</span><span class="n">rank</span><span class="o">=</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_of_envs</span><span class="p">)])</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">HER</span><span class="p">(</span><span class="s1">&#39;MlpPolicy&#39;</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">SAC</span><span class="p">,</span>
                <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">policy_kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">layers</span><span class="o">=</span><span class="p">[</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">]),</span>
                <span class="o">**</span><span class="n">sac_config</span><span class="p">)</span>
    <span class="n">save_config_file</span><span class="p">(</span><span class="n">sac_config</span><span class="p">,</span> <span class="n">_make_env</span><span class="p">(</span><span class="mi">0</span><span class="p">)(),</span>
                     <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">log_relative_path</span><span class="p">,</span> <span class="s1">&#39;config.json&#39;</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">total_time_steps</span> <span class="o">/</span> <span class="n">validate_every_timesteps</span><span class="p">)):</span>
        <span class="n">model</span><span class="o">.</span><span class="n">learn</span><span class="p">(</span><span class="n">total_timesteps</span><span class="o">=</span><span class="n">validate_every_timesteps</span><span class="p">,</span>
                    <span class="n">tb_log_name</span><span class="o">=</span><span class="s2">&quot;sac&quot;</span><span class="p">,</span>
                    <span class="n">reset_num_timesteps</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">log_relative_path</span><span class="p">,</span> <span class="s1">&#39;saved_model&#39;</span><span class="p">))</span>
    <span class="k">return</span>


<span class="k">def</span> <span class="nf">save_config_file</span><span class="p">(</span><span class="n">sac_config</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
    <span class="n">task_config</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get_task</span><span class="p">()</span><span class="o">.</span><span class="n">get_task_params</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">task_param</span> <span class="ow">in</span> <span class="n">task_config</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">task_config</span><span class="p">[</span><span class="n">task_param</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">task_config</span><span class="p">[</span><span class="n">task_param</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">task_config</span><span class="p">[</span><span class="n">task_param</span><span class="p">])</span>
    <span class="n">env_config</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">get_world_params</span><span class="p">()</span>
    <span class="n">env</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">configs_to_save</span> <span class="o">=</span> <span class="p">[</span><span class="n">task_config</span><span class="p">,</span> <span class="n">env_config</span><span class="p">,</span> <span class="n">sac_config</span><span class="p">]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">configs_to_save</span><span class="p">,</span> <span class="n">fout</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">ap</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="c1">#TODO: pass reward weights here!!</span>
    <span class="n">ap</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--seed_num&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;seed number&quot;</span><span class="p">)</span>
    <span class="n">ap</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--skip_frame&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;skip frame&quot;</span><span class="p">)</span>
    <span class="n">ap</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--max_episode_length&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">2500</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;maximum episode length&quot;</span><span class="p">)</span>
    <span class="n">ap</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--total_time_steps_per_update&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">default</span><span class="o">=</span><span class="mi">150000</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;total time steps per update&quot;</span><span class="p">)</span>
    <span class="n">ap</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--task_name&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">default</span><span class="o">=</span><span class="s2">&quot;reaching&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;the task nam for training&quot;</span><span class="p">)</span>
    <span class="n">ap</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--log_relative_path&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;log folder&quot;</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="n">ap</span><span class="o">.</span><span class="n">parse_args</span><span class="p">())</span>
    <span class="n">total_time_steps_per_update</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;total_time_steps_per_update&#39;</span><span class="p">])</span>
    <span class="n">num_of_envs</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">log_relative_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;log_relative_path&#39;</span><span class="p">])</span>
    <span class="n">maximum_episode_length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;max_episode_length&#39;</span><span class="p">])</span>
    <span class="n">skip_frame</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;skip_frame&#39;</span><span class="p">])</span>
    <span class="n">seed_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;seed_num&#39;</span><span class="p">])</span>
    <span class="n">task_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;task_name&#39;</span><span class="p">])</span>
    <span class="k">assert</span> <span class="p">(((</span><span class="nb">float</span><span class="p">(</span><span class="n">total_time_steps_per_update</span><span class="p">)</span> <span class="o">/</span>
             <span class="n">num_of_envs</span><span class="p">)</span><span class="o">/</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">is_integer</span><span class="p">())</span>
    <span class="c1">#params are taken from</span>
    <span class="c1">#https://github.com/araffin/rl-baselines-zoo/blob/master/hyperparams/her.yml</span>
    <span class="n">sac_config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;n_sampled_goal&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
                  <span class="s2">&quot;goal_selection_strategy&quot;</span><span class="p">:</span> <span class="s1">&#39;future&#39;</span><span class="p">,</span>
                  <span class="s2">&quot;learning_rate&quot;</span><span class="p">:</span> <span class="mf">0.001</span><span class="p">,</span>
                  <span class="s2">&quot;train_freq&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                  <span class="s2">&quot;gradient_steps&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                  <span class="s2">&quot;learning_starts&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
                  <span class="s2">&quot;tensorboard_log&quot;</span><span class="p">:</span> <span class="n">log_relative_path</span><span class="p">,</span>
                  <span class="s2">&quot;buffer_size&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1e6</span><span class="p">),</span>
                   <span class="s2">&quot;gamma&quot;</span><span class="p">:</span> <span class="mf">0.95</span><span class="p">,</span>
                   <span class="s2">&quot;batch_size&quot;</span><span class="p">:</span> <span class="mi">256</span><span class="p">,</span>
                   <span class="s2">&quot;ent_coef&quot;</span><span class="p">:</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span>
                   <span class="s2">&quot;random_exploration&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">}</span>
    <span class="n">train_policy</span><span class="p">(</span><span class="n">num_of_envs</span><span class="o">=</span><span class="n">num_of_envs</span><span class="p">,</span>
                 <span class="n">log_relative_path</span><span class="o">=</span><span class="n">log_relative_path</span><span class="p">,</span>
                 <span class="n">maximum_episode_length</span><span class="o">=</span><span class="n">maximum_episode_length</span><span class="p">,</span>
                 <span class="n">skip_frame</span><span class="o">=</span><span class="n">skip_frame</span><span class="p">,</span>
                 <span class="n">seed_num</span><span class="o">=</span><span class="n">seed_num</span><span class="p">,</span>
                 <span class="n">sac_config</span><span class="o">=</span><span class="n">sac_config</span><span class="p">,</span>
                 <span class="n">total_time_steps</span><span class="o">=</span><span class="mi">60000000</span><span class="p">,</span>
                 <span class="n">validate_every_timesteps</span><span class="o">=</span><span class="mi">1000000</span><span class="p">,</span>
                 <span class="n">task_name</span><span class="o">=</span><span class="n">task_name</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="viewing-and-recording-policies-or-logged-data">
<h2>Viewing and recording policies or logged data<a class="headerlink" href="#viewing-and-recording-policies-or-logged-data" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">causal_rl_bench.task_generators.task</span> <span class="kn">import</span> <span class="n">task_generator</span>
<span class="kn">from</span> <span class="nn">causal_rl_bench.actors.reacher_policy</span> <span class="kn">import</span> <span class="n">ReacherActorPolicy</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="n">tf</span><span class="o">.</span><span class="n">compat</span><span class="o">.</span><span class="n">v1</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">set_verbosity</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">compat</span><span class="o">.</span><span class="n">v1</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">causal_rl_bench.viewers.task_viewer</span> <span class="k">as</span> <span class="nn">viewer</span>


<span class="k">def</span> <span class="nf">example</span><span class="p">():</span>
    <span class="c1"># This tutorial shows how to view a pretrained reacher policy</span>
    <span class="n">task</span> <span class="o">=</span> <span class="n">task_generator</span><span class="p">(</span><span class="n">task_generator_id</span><span class="o">=</span><span class="s1">&#39;reaching&#39;</span><span class="p">)</span>
    <span class="n">world_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">world_params</span><span class="p">[</span><span class="s2">&quot;skip_frame&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">world_params</span><span class="p">[</span><span class="s2">&quot;seed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">agent</span> <span class="o">=</span> <span class="n">ReacherActorPolicy</span><span class="p">()</span>

    <span class="c1"># define a method for the policy fn of your trained model</span>
    <span class="k">def</span> <span class="nf">policy_fn</span><span class="p">(</span><span class="n">obs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">agent</span><span class="o">.</span><span class="n">act</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>

    <span class="c1"># Similarly for interactive visualization in the GUI</span>
    <span class="n">viewer</span><span class="o">.</span><span class="n">view_policy</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span>
                       <span class="n">world_params</span><span class="o">=</span><span class="n">world_params</span><span class="p">,</span>
                       <span class="n">policy_fn</span><span class="o">=</span><span class="n">policy_fn</span><span class="p">,</span>
                       <span class="n">max_time_steps</span><span class="o">=</span><span class="mi">40</span><span class="o">*</span><span class="mi">960</span><span class="p">,</span>
                       <span class="n">number_of_resets</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">example</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">causal_rl_bench.viewers.task_viewer</span> <span class="k">as</span> <span class="nn">viewer</span>
<span class="kn">from</span> <span class="nn">causal_rl_bench.loggers.data_loader</span> <span class="kn">import</span> <span class="n">DataLoader</span>


<span class="k">def</span> <span class="nf">example</span><span class="p">():</span>
    <span class="c1"># This tutorial shows how to view logged episodes</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">episode_directory</span><span class="o">=</span><span class="s1">&#39;pushing_episodes&#39;</span><span class="p">)</span>
    <span class="n">episode</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get_episode</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>

    <span class="c1"># Record a video of the logged episode is done in one line</span>
    <span class="n">viewer</span><span class="o">.</span><span class="n">record_video_of_episode</span><span class="p">(</span><span class="n">episode</span><span class="o">=</span><span class="n">episode</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">&quot;pushing_video&quot;</span><span class="p">)</span>

    <span class="c1"># Similarly for interactive visualization in the GUI</span>
    <span class="n">viewer</span><span class="o">.</span><span class="n">view_episode</span><span class="p">(</span><span class="n">episode</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">example</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">causal_rl_bench.task_generators.task</span> <span class="kn">import</span> <span class="n">task_generator</span>
<span class="kn">import</span> <span class="nn">causal_rl_bench.viewers.task_viewer</span> <span class="k">as</span> <span class="nn">viewer</span>
<span class="kn">from</span> <span class="nn">causal_rl_bench.loggers.data_loader</span> <span class="kn">import</span> <span class="n">DataLoader</span>


<span class="k">def</span> <span class="nf">example</span><span class="p">():</span>
    <span class="c1"># This tutorial shows how to view a random policy on the pyramid task</span>

    <span class="n">task</span> <span class="o">=</span> <span class="n">task_generator</span><span class="p">(</span><span class="n">task_generator_id</span><span class="o">=</span><span class="s1">&#39;pyramid&#39;</span><span class="p">)</span>
    <span class="n">world_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">world_params</span><span class="p">[</span><span class="s2">&quot;skip_frame&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">world_params</span><span class="p">[</span><span class="s2">&quot;seed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span>

    <span class="n">viewer</span><span class="o">.</span><span class="n">record_video_of_random_policy</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span>
                                         <span class="n">world_params</span><span class="o">=</span><span class="n">world_params</span><span class="p">,</span>
                                         <span class="n">file_name</span><span class="o">=</span><span class="s2">&quot;pyramid_video&quot;</span><span class="p">,</span>
                                         <span class="n">number_of_resets</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                         <span class="n">max_time_steps</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">example</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">causal_rl_bench.task_generators.task</span> <span class="kn">import</span> <span class="n">task_generator</span>
<span class="kn">from</span> <span class="nn">stable_baselines</span> <span class="kn">import</span> <span class="n">SAC</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="n">tf</span><span class="o">.</span><span class="n">compat</span><span class="o">.</span><span class="n">v1</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">set_verbosity</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">compat</span><span class="o">.</span><span class="n">v1</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">causal_rl_bench.viewers.task_viewer</span> <span class="k">as</span> <span class="nn">viewer</span>


<span class="k">def</span> <span class="nf">example</span><span class="p">():</span>
    <span class="c1"># This tutorial shows how to view policies of trained actors</span>

    <span class="n">task</span> <span class="o">=</span> <span class="n">task_generator</span><span class="p">(</span><span class="n">task_generator_id</span><span class="o">=</span><span class="s1">&#39;picking&#39;</span><span class="p">)</span>
    <span class="n">world_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">world_params</span><span class="p">[</span><span class="s2">&quot;skip_frame&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">world_params</span><span class="p">[</span><span class="s2">&quot;seed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">stable_baselines_policy_path</span> <span class="o">=</span> <span class="s2">&quot;./model_2000000_steps.zip&quot;</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">SAC</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">stable_baselines_policy_path</span><span class="p">)</span>

    <span class="c1"># define a method for the policy fn of your trained model</span>
    <span class="k">def</span> <span class="nf">policy_fn</span><span class="p">(</span><span class="n">obs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">deterministic</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># # Record a video of the policy is done in one line</span>
    <span class="n">viewer</span><span class="o">.</span><span class="n">record_video_of_policy</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span>
                                  <span class="n">world_params</span><span class="o">=</span><span class="n">world_params</span><span class="p">,</span>
                                  <span class="n">policy_fn</span><span class="o">=</span><span class="n">policy_fn</span><span class="p">,</span>
                                  <span class="n">file_name</span><span class="o">=</span><span class="s2">&quot;pushing_video&quot;</span><span class="p">,</span>
                                  <span class="n">number_of_resets</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                  <span class="n">max_time_steps</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>

    <span class="c1"># Similarly for interactive visualization in the GUI</span>
    <span class="n">viewer</span><span class="o">.</span><span class="n">view_policy</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span>
                       <span class="n">world_params</span><span class="o">=</span><span class="n">world_params</span><span class="p">,</span>
                       <span class="n">policy_fn</span><span class="o">=</span><span class="n">policy_fn</span><span class="p">,</span>
                       <span class="n">max_time_steps</span><span class="o">=</span><span class="mi">40</span><span class="o">*</span><span class="mi">600</span><span class="p">,</span>
                       <span class="n">number_of_resets</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">example</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="defining-a-training-curriculum-of-task-variations">
<h2>Defining a training curriculum of task variations<a class="headerlink" href="#defining-a-training-curriculum-of-task-variations" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">causal_rl_bench.task_generators.task</span> <span class="kn">import</span> <span class="n">task_generator</span>
<span class="kn">from</span> <span class="nn">causal_rl_bench.envs.causalworld</span> <span class="kn">import</span> <span class="n">CausalWorld</span>
<span class="kn">from</span> <span class="nn">causal_rl_bench.intervention_actors</span> <span class="kn">import</span> <span class="n">GoalInterventionActorPolicy</span><span class="p">,</span> <span class="n">VisualInterventionActorPolicy</span><span class="p">,</span> \
    <span class="n">RandomInterventionActorPolicy</span>
<span class="kn">from</span> <span class="nn">causal_rl_bench.wrappers.curriculum_wrappers</span> <span class="kn">import</span> <span class="n">CurriculumWrapper</span>


<span class="k">def</span> <span class="nf">example</span><span class="p">():</span>
    <span class="c1">#initialize env</span>
    <span class="n">task_gen</span> <span class="o">=</span> <span class="n">task_generator</span><span class="p">(</span><span class="n">task_generator_id</span><span class="o">=</span><span class="s1">&#39;pushing&#39;</span><span class="p">)</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">CausalWorld</span><span class="p">(</span><span class="n">task_gen</span><span class="p">,</span> <span class="n">skip_frame</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                      <span class="n">enable_visualization</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># define a custom curriculum of interventions:</span>

    <span class="c1"># No intervention actor is defined until episode number 5</span>
    <span class="c1"># Goal intervention actor from episode number 5 to 10 after reset at time step 0</span>
    <span class="c1"># Visual intervention actor from episode number 10 to 20 every two episodes after reset at time step 0</span>
    <span class="c1"># Random intervention actor from episode number 20 to 25 after reset at time step 0</span>
    <span class="c1"># Goal intervention actor from episode number 25 to 30 each at time step 50</span>

    <span class="n">env</span> <span class="o">=</span> <span class="n">CurriculumWrapper</span><span class="p">(</span><span class="n">env</span><span class="p">,</span>
                            <span class="n">intervention_actors</span><span class="o">=</span><span class="p">[</span><span class="n">GoalInterventionActorPolicy</span><span class="p">(),</span>
                                                 <span class="n">VisualInterventionActorPolicy</span><span class="p">(),</span>
                                                 <span class="n">RandomInterventionActorPolicy</span><span class="p">(),</span>
                                                 <span class="n">GoalInterventionActorPolicy</span><span class="p">()],</span>
                            <span class="n">actives</span><span class="o">=</span><span class="p">[(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                                     <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                                     <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                                     <span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">50</span><span class="p">)])</span>

    <span class="k">for</span> <span class="n">reset_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">):</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
            <span class="n">desired_action</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
            <span class="n">obs</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="n">desired_action</span><span class="p">)</span>
    <span class="n">env</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">example</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="changing-the-action-space-of-the-robot">
<h2>Changing the action space of the robot<a class="headerlink" href="#changing-the-action-space-of-the-robot" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">causal_rl_bench.envs.causalworld</span> <span class="kn">import</span> <span class="n">CausalWorld</span>
<span class="kn">from</span> <span class="nn">causal_rl_bench.task_generators.task</span> <span class="kn">import</span> <span class="n">task_generator</span>
<span class="kn">from</span> <span class="nn">causal_rl_bench.wrappers.action_wrappers</span> <span class="kn">import</span> <span class="n">DeltaActionEnvWrapper</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>


<span class="k">def</span> <span class="nf">apply_delta_action</span><span class="p">():</span>
    <span class="n">task</span> <span class="o">=</span> <span class="n">task_generator</span><span class="p">(</span><span class="n">task_generator_id</span><span class="o">=</span><span class="s1">&#39;reaching&#39;</span><span class="p">)</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">CausalWorld</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span> <span class="n">enable_visualization</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">action_mode</span><span class="o">=</span><span class="s2">&quot;joint_positions&quot;</span><span class="p">,</span>
                      <span class="n">normalize_actions</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">normalize_observations</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skip_frame</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">DeltaActionEnvWrapper</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">):</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
            <span class="n">desired_action</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">9</span><span class="p">,])</span>
            <span class="n">current_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">obs</span><span class="p">[:</span><span class="mi">9</span><span class="p">],</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;what I wanted to reach&quot;</span><span class="p">,</span> <span class="n">current_obs</span> <span class="o">+</span> <span class="n">desired_action</span><span class="p">)</span>
            <span class="n">obs</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">desired_action</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;what I actually reached&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">obs</span><span class="p">[:</span><span class="mi">9</span><span class="p">],</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;diff is&quot;</span><span class="p">,</span> <span class="n">current_obs</span> <span class="o">+</span> <span class="n">desired_action</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">obs</span><span class="p">[:</span><span class="mi">9</span><span class="p">],</span>
                                                                      <span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
                <span class="c1"># desired_action = obs[:9]</span>
    <span class="n">env</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">apply_delta_action</span><span class="p">()</span>

</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">causal_rl_bench.envs.causalworld</span> <span class="kn">import</span> <span class="n">CausalWorld</span>
<span class="kn">from</span> <span class="nn">causal_rl_bench.task_generators.task</span> <span class="kn">import</span> <span class="n">task_generator</span>
<span class="kn">from</span> <span class="nn">causal_rl_bench.wrappers.planning_wrappers</span> <span class="kn">import</span> <span class="n">ObjectSelectorWrapper</span>


<span class="k">def</span> <span class="nf">example</span><span class="p">():</span>
    <span class="n">task</span> <span class="o">=</span> <span class="n">task_generator</span><span class="p">(</span><span class="n">task_generator_id</span><span class="o">=</span><span class="s1">&#39;picking&#39;</span><span class="p">)</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">CausalWorld</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span> <span class="n">enable_visualization</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">ObjectSelectorWrapper</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">):</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="c1">#go up</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">80</span><span class="p">):</span>
            <span class="n">obs</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="c1"># rotate yaw</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
            <span class="n">obs</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">):</span>
            <span class="n">obs</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
            <span class="n">obs</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="c1"># print(obs)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">):</span>
            <span class="n">obs</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="c1"># print(obs)</span>
    <span class="n">env</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">example</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">causal_rl_bench.envs.causalworld</span> <span class="kn">import</span> <span class="n">CausalWorld</span>
<span class="kn">from</span> <span class="nn">causal_rl_bench.task_generators.task</span> <span class="kn">import</span> <span class="n">task_generator</span>
<span class="kn">from</span> <span class="nn">causal_rl_bench.wrappers.action_wrappers</span> <span class="kn">import</span> <span class="n">MovingAverageActionEnvWrapper</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>


<span class="k">def</span> <span class="nf">apply_delta_action</span><span class="p">():</span>
    <span class="n">task</span> <span class="o">=</span> <span class="n">task_generator</span><span class="p">(</span><span class="n">task_generator_id</span><span class="o">=</span><span class="s1">&#39;reaching&#39;</span><span class="p">)</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">CausalWorld</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span> <span class="n">enable_visualization</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">action_mode</span><span class="o">=</span><span class="s2">&quot;joint_positions&quot;</span><span class="p">,</span>
                      <span class="n">normalize_actions</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">normalize_observations</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skip_frame</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">MovingAverageActionEnvWrapper</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">):</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
            <span class="n">desired_action</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">9</span><span class="p">,])</span>
            <span class="n">current_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">obs</span><span class="p">[:</span><span class="mi">9</span><span class="p">],</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;what I wanted to reach&quot;</span><span class="p">,</span> <span class="n">current_obs</span> <span class="o">+</span> <span class="n">desired_action</span><span class="p">)</span>
            <span class="n">obs</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">desired_action</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;what I actually reached&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">obs</span><span class="p">[:</span><span class="mi">9</span><span class="p">],</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;diff is&quot;</span><span class="p">,</span> <span class="n">current_obs</span> <span class="o">+</span> <span class="n">desired_action</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">obs</span><span class="p">[:</span><span class="mi">9</span><span class="p">],</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
                <span class="c1"># desired_action = obs[:9]</span>
    <span class="n">env</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">apply_delta_action</span><span class="p">()</span>

</pre></div>
</div>
</div>
<div class="section" id="other-utilities-model-predictive-control-logging-data-loading-wrapped-environments">
<h2>Other Utilities: Model Predictive Control, Logging data, loading wrapped environments<a class="headerlink" href="#other-utilities-model-predictive-control-logging-data-loading-wrapped-environments" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">stable_baselines.common</span> <span class="kn">import</span> <span class="n">set_global_seeds</span>
<span class="kn">from</span> <span class="nn">causal_rl_bench.envs.causalworld</span> <span class="kn">import</span> <span class="n">CausalWorld</span>
<span class="kn">from</span> <span class="nn">causal_rl_bench.baselines.model_based.true_model</span> <span class="kn">import</span> <span class="n">TrueModel</span>
<span class="kn">from</span> <span class="nn">causal_rl_bench.baselines.model_based.optimizers.cem</span> <span class="kn">import</span> \
    <span class="n">CrossEntropyMethod</span>
<span class="kn">from</span> <span class="nn">gym.wrappers.monitoring.video_recorder</span> <span class="kn">import</span> <span class="n">VideoRecorder</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">causal_rl_bench.task_generators.task</span> <span class="kn">import</span> <span class="n">task_generator</span>


<span class="n">seed</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">skip_frame</span> <span class="o">=</span> <span class="mi">35</span>
<span class="n">num_of_particles</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">num_elite</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">max_iterations</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">horizon_length</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">parallel_agents</span> <span class="o">=</span> <span class="mi">25</span>


<span class="k">def</span> <span class="nf">_make_env</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">_init</span><span class="p">():</span>
        <span class="n">task</span> <span class="o">=</span> <span class="n">task_generator</span><span class="p">(</span><span class="n">task_generator_id</span><span class="o">=</span><span class="s1">&#39;picking&#39;</span><span class="p">,</span>
                              <span class="n">joint_positions</span><span class="o">=</span><span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.6</span><span class="p">,</span>
                                               <span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.4</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.7</span><span class="p">,</span>
                                               <span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.4</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.7</span><span class="p">],</span>
                              <span class="n">tool_block_position</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.035</span><span class="p">],</span>
                              <span class="n">fractional_reward_weight</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                              <span class="n">dense_reward_weights</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                                             <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                                             <span class="mi">0</span><span class="p">]))</span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">CausalWorld</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span> <span class="n">skip_frame</span><span class="o">=</span><span class="n">skip_frame</span><span class="p">,</span>
                          <span class="n">enable_visualization</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">env</span>
    <span class="n">set_global_seeds</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_init</span>


<span class="k">def</span> <span class="nf">run_mpc</span><span class="p">():</span>
    <span class="n">task</span> <span class="o">=</span> <span class="n">task_generator</span><span class="p">(</span><span class="n">task_generator_id</span><span class="o">=</span><span class="s1">&#39;picking&#39;</span><span class="p">,</span>
                          <span class="n">joint_positions</span><span class="o">=</span><span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.6</span><span class="p">,</span>
                                           <span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.4</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.7</span><span class="p">,</span>
                                           <span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.4</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.7</span><span class="p">],</span>
                          <span class="n">tool_block_position</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.035</span><span class="p">],</span>
                          <span class="n">fractional_reward_weight</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                          <span class="n">dense_reward_weights</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                                         <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                                         <span class="mi">0</span><span class="p">]))</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">CausalWorld</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span> <span class="n">skip_frame</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                      <span class="n">enable_visualization</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                      <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">true_model</span> <span class="o">=</span> <span class="n">TrueModel</span><span class="p">(</span><span class="n">_make_env</span><span class="p">,</span> <span class="n">parallel_agents</span><span class="o">=</span><span class="n">parallel_agents</span><span class="p">)</span>
    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">CrossEntropyMethod</span><span class="p">(</span><span class="n">planning_horizon</span><span class="o">=</span><span class="n">horizon_length</span><span class="p">,</span>
                                   <span class="n">max_iterations</span><span class="o">=</span><span class="n">max_iterations</span><span class="p">,</span>
                                   <span class="n">population_size</span><span class="o">=</span><span class="n">num_of_particles</span><span class="p">,</span>
                                   <span class="n">num_elite</span><span class="o">=</span><span class="n">num_elite</span><span class="p">,</span>
                                   <span class="n">action_upper_bound</span><span class="o">=</span>
                                   <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">high</span><span class="p">),</span>
                                   <span class="n">action_lower_bound</span><span class="o">=</span>
                                   <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">low</span><span class="p">),</span>
                                   <span class="n">model</span><span class="o">=</span><span class="n">true_model</span><span class="p">)</span>
    <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
    <span class="n">actions</span> <span class="o">=</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">get_actions</span><span class="p">()</span>
    <span class="n">true_model</span><span class="o">.</span><span class="n">end_sim</span><span class="p">()</span>
    <span class="n">recorder</span> <span class="o">=</span> <span class="n">VideoRecorder</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="s1">&#39;picking.mp4&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">horizon_length</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">skip_frame</span><span class="p">):</span>
            <span class="n">recorder</span><span class="o">.</span><span class="n">capture_frame</span><span class="p">()</span>
            <span class="n">obs</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">actions</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">recorder</span><span class="o">.</span><span class="n">capture_frame</span><span class="p">()</span>
    <span class="n">recorder</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">env</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">run_mpc</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">causal_rl_bench.envs.causalworld</span> <span class="kn">import</span> <span class="n">CausalWorld</span>
<span class="kn">from</span> <span class="nn">causal_rl_bench.task_generators.task</span> <span class="kn">import</span> <span class="n">task_generator</span>

<span class="kn">from</span> <span class="nn">causal_rl_bench.loggers.data_recorder</span> <span class="kn">import</span> <span class="n">DataRecorder</span>
<span class="kn">from</span> <span class="nn">causal_rl_bench.loggers.data_loader</span> <span class="kn">import</span> <span class="n">DataLoader</span>

<span class="kn">import</span> <span class="nn">causal_rl_bench.viewers.task_viewer</span> <span class="k">as</span> <span class="nn">viewer</span>


<span class="k">def</span> <span class="nf">example</span><span class="p">():</span>
    <span class="c1"># Here you learn how to record/ log entire episodes into a directory</span>
    <span class="c1"># to reuse it later e.g. for reviewing logged episodes or using this</span>
    <span class="c1"># data for pre-training  policies.</span>

    <span class="c1"># Construct a data_recorder that keeps track of every change in the environment</span>
    <span class="c1"># We set the recording dumb frequency of episodes into log_files to 11 (default is 100)</span>
    <span class="n">data_recorder</span> <span class="o">=</span> <span class="n">DataRecorder</span><span class="p">(</span><span class="n">output_directory</span><span class="o">=</span><span class="s1">&#39;pushing_episodes&#39;</span><span class="p">,</span> <span class="n">rec_dumb_frequency</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>

    <span class="c1"># Pass the data recorder to the World</span>
    <span class="n">task</span> <span class="o">=</span> <span class="n">task_generator</span><span class="p">(</span><span class="n">task_generator_id</span><span class="o">=</span><span class="s1">&#39;pushing&#39;</span><span class="p">)</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">CausalWorld</span><span class="p">(</span><span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span>
                      <span class="n">enable_visualization</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">data_recorder</span><span class="o">=</span><span class="n">data_recorder</span><span class="p">)</span>

    <span class="c1"># Record some episodes</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">23</span><span class="p">):</span>
        <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">):</span>
            <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">sample</span><span class="p">())</span>
    <span class="n">env</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c1"># Load the logged episodes</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">episode_directory</span><span class="o">=</span><span class="s1">&#39;pushing_episodes&#39;</span><span class="p">)</span>
    <span class="n">episode</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get_episode</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span>

    <span class="c1"># Initialize a new environment according a specific episode and replay it</span>
    <span class="n">task</span> <span class="o">=</span> <span class="n">task_generator</span><span class="p">(</span><span class="n">episode</span><span class="o">.</span><span class="n">_task_name</span><span class="p">,</span> <span class="o">**</span><span class="n">episode</span><span class="o">.</span><span class="n">_task_params</span><span class="p">)</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">CausalWorld</span><span class="p">(</span><span class="n">task</span><span class="p">,</span>
                      <span class="o">**</span><span class="n">episode</span><span class="o">.</span><span class="n">world_params</span><span class="p">,</span>
                      <span class="n">logging</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                      <span class="n">enable_visualization</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">env</span><span class="o">.</span><span class="n">set_full_state</span><span class="p">(</span><span class="n">episode</span><span class="o">.</span><span class="n">initial_full_state</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">episode</span><span class="o">.</span><span class="n">robot_actions</span><span class="p">:</span>
        <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
    <span class="n">env</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c1"># You can achieve the same by using the viewer module in one line</span>
    <span class="n">viewer</span><span class="o">.</span><span class="n">view_episode</span><span class="p">(</span><span class="n">episode</span><span class="p">)</span>

    <span class="c1"># TODO: I get an issue with closing the environment and it gets rendered from a strange camera view. Doo you get the same error?</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">example</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">causal_rl_bench.utils.config_utils</span> <span class="kn">import</span> <span class="n">load_world</span>
<span class="kn">from</span> <span class="nn">causal_rl_bench.task_generators.task</span> <span class="kn">import</span> <span class="n">task_generator</span>
<span class="kn">from</span> <span class="nn">causal_rl_bench.envs.causalworld</span> <span class="kn">import</span> <span class="n">CausalWorld</span>
<span class="kn">from</span> <span class="nn">causal_rl_bench.intervention_actors</span> <span class="kn">import</span> <span class="n">VisualInterventionActorPolicy</span>
<span class="kn">from</span> <span class="nn">causal_rl_bench.curriculum</span> <span class="kn">import</span> <span class="n">Curriculum</span>
<span class="kn">from</span> <span class="nn">causal_rl_bench.wrappers.curriculum_wrappers</span> <span class="kn">import</span> <span class="n">CurriculumWrapper</span>
<span class="kn">from</span> <span class="nn">causal_rl_bench.wrappers</span> <span class="kn">import</span> <span class="n">DeltaActionEnvWrapper</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>


<span class="k">def</span> <span class="nf">example</span><span class="p">():</span>
    <span class="c1">#initialize env</span>
    <span class="n">task_gen</span> <span class="o">=</span> <span class="n">task_generator</span><span class="p">(</span><span class="n">task_generator_id</span><span class="o">=</span><span class="s1">&#39;pushing&#39;</span><span class="p">)</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">CausalWorld</span><span class="p">(</span><span class="n">task_gen</span><span class="p">,</span> <span class="n">skip_frame</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                      <span class="n">enable_visualization</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">DeltaActionEnvWrapper</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">CurriculumWrapper</span><span class="p">(</span><span class="n">env</span><span class="p">,</span>
                            <span class="n">intervention_actors</span><span class="o">=</span><span class="p">[</span>
                                <span class="n">VisualInterventionActorPolicy</span><span class="p">()],</span>
                            <span class="n">actives</span><span class="o">=</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)])</span>

    <span class="k">for</span> <span class="n">reset_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">15</span><span class="p">):</span>
            <span class="n">obs</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">9</span><span class="p">,))</span>
    <span class="n">env</span><span class="o">.</span><span class="n">save_world</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="p">)</span>
    <span class="n">env</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="c1">#now load it again</span>

    <span class="n">env</span> <span class="o">=</span> <span class="n">load_world</span><span class="p">(</span><span class="n">tracker_relative_path</span><span class="o">=</span><span class="s1">&#39;./&#39;</span><span class="p">,</span> <span class="n">enable_visualization</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">reset_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">15</span><span class="p">):</span>
            <span class="n">obs</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">9</span><span class="p">,))</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">example</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="task_setups.html" class="btn btn-neutral float-right" title="Task distributions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="install.html" class="btn btn-neutral float-left" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Ossama Ahmed and Frederik Trauble

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>